<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FutureLock | Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#F7F1E7; --surface:#FFF9F0; --ink:#1F2A24; --muted:#516158;
      --green:#1F7A4A; --green2:#2EA56A; --line:rgba(31,42,36,0.12);
      --shadow:0 18px 40px rgba(23,40,30,0.12); --radius:18px;
      --warnbg:rgba(244,180,0,0.14);
      --badbg:rgba(185,64,64,0.12);
      --bad:#B94040;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(46,165,106,0.18), transparent 55%),
        radial-gradient(900px 500px at 95% 20%, rgba(31,122,74,0.16), transparent 60%),
        linear-gradient(180deg, var(--bg), #F3EBDD);
      color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      line-height:1.5;
    }
    a{color:inherit; text-decoration:none}
    .wrap{max-width:1180px; margin:0 auto; padding:22px 18px 70px;}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; padding: 8px 6px 18px;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700;}
    .logo{width:38px; height:38px; border-radius:12px; background:linear-gradient(135deg,var(--green),var(--green2)); box-shadow:0 10px 20px rgba(31,122,74,0.18); position:relative; overflow:hidden;}
    .logo:before{content:""; position:absolute; width:42px; height:42px; border-radius:16px; left:-12px; top:16px; background:rgba(255,255,255,0.28); transform:rotate(22deg);}
    .brand span{font-family:Fraunces,serif; font-size:20px;}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 16px; border-radius:14px; border:1px solid rgba(31,122,74,0.22); cursor:pointer; font-weight:600; background:rgba(255,255,255,0.55); transition:transform 160ms ease;}
    .btn:hover{transform:translateY(-1px);}
    .btn.primary{border:none; color:#fff; background:linear-gradient(135deg,var(--green),var(--green2)); box-shadow:0 14px 28px rgba(31,122,74,0.22);}
    .btn.danger{border:none; color:#fff; background:linear-gradient(135deg,#b94040,#e05b5b); box-shadow:0 14px 28px rgba(185,64,64,0.22);}
    .pill{display:inline-flex; align-items:center; gap:10px; padding:8px 12px; border-radius:999px; border:1px solid rgba(31,122,74,0.18); background:rgba(255,255,255,0.65); color:var(--muted); font-size:13px; font-weight:700;}
    .dot{width:10px; height:10px; border-radius:50%; background:var(--green2); box-shadow:0 0 0 6px rgba(46,165,106,0.14);}

    .card{background:rgba(255,249,240,0.82); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden;}
    .hero{display:grid; grid-template-columns:1fr 320px; gap:14px; align-items:center; padding:18px;}
    h1{margin:10px 0 8px; font-family:Fraunces,serif; font-size:clamp(30px, 3.8vw, 42px); letter-spacing:-0.4px; line-height:1.05;}
    .sub{margin:0; color:var(--muted); font-size:15px;}
    .heroArt{border-radius:18px; border:1px solid rgba(31,42,36,0.10); background:rgba(255,255,255,0.62); padding:12px; height:220px; display:flex; align-items:center; justify-content:center; overflow:hidden;}

    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin-top:12px;}
    .badge{display:inline-flex; font-size:12px; font-weight:900; padding:7px 10px; border-radius:999px; border:1px solid rgba(46,165,106,0.25); background:rgba(46,165,106,0.16); color:var(--green); white-space:nowrap;}
    .badge.bad{border-color:rgba(185,64,64,0.30); background:rgba(185,64,64,0.14); color:#8e2d2d;}

    .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px;}
    .kpi{background:rgba(255,255,255,0.62); border:1px solid rgba(31,42,36,0.10); border-radius:16px; padding:12px; min-height:90px;}
    .kpi .label{font-size:12px; font-weight:900; letter-spacing:0.2px; text-transform:uppercase; color:rgba(31,42,36,0.65); margin-bottom:6px;}
    .kpi .value{font-size:18px; font-weight:900;}
    .kpi .note{font-size:12px; color:var(--muted); margin-top:6px;}

    .grid{display:grid; grid-template-columns:1.15fr 0.85fr; gap:18px; align-items:start; margin-top:14px;}
    .pad{padding:18px;}
    .miniTitle{font-weight:900; letter-spacing:0.2px; text-transform:uppercase; font-size:12px; color:rgba(31,42,36,0.65); margin-bottom:10px;}
    .controls{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    .field{background:rgba(255,255,255,0.62); border:1px solid rgba(31,42,36,0.10); border-radius:16px; padding:12px;}
    label{display:block; font-size:12px; font-weight:900; color:rgba(31,42,36,0.70); margin-bottom:6px; letter-spacing:0.2px; text-transform:uppercase;}
    input, select{width:100%; border-radius:12px; border:1px solid rgba(31,42,36,0.14); padding:11px 12px; font-size:14px; outline:none; background:rgba(255,255,255,0.82); color:var(--ink);}
    input:focus, select:focus{border-color:rgba(46,165,106,0.55); box-shadow:0 0 0 4px rgba(46,165,106,0.14);}
    .hint{margin-top:6px; font-size:12px; color:var(--muted);}
    .divider{height:1px; background:rgba(31,42,36,0.12); margin:14px 0;}

    .progressWrap{background:rgba(255,255,255,0.62); border:1px solid rgba(31,42,36,0.10); border-radius:18px; padding:12px;}
    .progressBar{height:14px; border-radius:999px; overflow:hidden; border:1px solid rgba(31,42,36,0.12); background:rgba(255,255,255,0.55); display:flex;}
    .progGood{background:linear-gradient(135deg,var(--green),var(--green2)); height:100%;}
    .progBad{background:linear-gradient(135deg,#c35c5c,#e07d7d); height:100%;}
    .progMeta{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:10px; font-size:13px; color:var(--muted);}

    .chartBox{background:rgba(255,255,255,0.62); border:1px solid rgba(31,42,36,0.10); border-radius:18px; padding:12px;}
    canvas{width:100%; height:240px; display:block;}

    .notice{padding:12px; border-radius:16px; border:1px solid rgba(201,138,0,0.20); background:var(--warnbg); color:#6b4c00; font-weight:800; font-size:13px;}
    .notice.bad{border-color:rgba(185,64,64,0.22); background:var(--badbg); color:#7c2c2c;}

    details{border-radius:16px; border:1px dashed rgba(31,42,36,0.18); background:rgba(255,255,255,0.45); padding:10px 12px; margin-top:10px;}
    summary{cursor:pointer; font-weight:900; color:rgba(31,42,36,0.75); text-transform:uppercase; letter-spacing:0.2px; font-size:12px;}

    .modalBack{position:fixed; inset:0; background:rgba(0,0,0,0.32); display:none; align-items:center; justify-content:center; padding:18px; z-index:50;}
    .modal{width:min(620px, 100%); border-radius:20px; background:rgba(255,255,255,0.94); border:1px solid rgba(31,42,36,0.16); box-shadow:0 24px 60px rgba(0,0,0,0.20); padding:16px;}
    .modal h3{margin:0 0 8px; font-family:Fraunces,serif;}
    .modal p{margin:0 0 12px; color:var(--muted);}
    .modalActions{display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;}

    .footer{margin-top:16px; color:rgba(31,42,36,0.60); font-size:13px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; padding:0 6px;}

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      .hero{grid-template-columns:1fr;}
      .kpis{grid-template-columns:1fr;}
      .controls{grid-template-columns:1fr;}
      .heroArt{height:200px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <a class="brand" href="index.html">
        <div class="logo" aria-hidden="true"></div>
        <span>FutureLock</span>
      </a>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn" href="planner.html">Edit my plan</a>
        <a class="btn" href="pricing.html">Pricing</a>
        <button class="btn danger" id="redeemBtn" type="button">Redeem / Withdraw</button>
      </div>
    </div>

    <div class="card">
      <div class="hero">
        <div>
          <div class="pill"><span class="dot"></span> Your future depends less on returns and more on discipline.</div>
          <h1 id="headlineGoal">Your goal dashboard</h1>
          <p class="sub">Automate financial commitments and stay on track — FutureLock keeps you honest when motivation isn’t.</p>

          <div class="row">
            <span class="badge" id="goalBadge">Goal: —</span>
            <span class="badge" id="planBadge" style="display:none;">Plan: —</span>
            <span class="badge" id="confidenceBadge">On-time chance: —</span>
          </div>

          <div class="kpis">
            <div class="kpi">
              <div class="label">Target corpus at goal year</div>
              <div class="value" id="kpiTarget">—</div>
              <div class="note">Inflation-adjusted estimate (editable below).</div>
            </div>

            <div class="kpi">
              <div class="label">Your projected corpus</div>
              <div class="value" id="kpiProjected">—</div>
              <div class="note" id="kpiGapNote">Gap: —</div>
            </div>

            <div class="kpi">
              <div class="label">Required monthly SIP</div>
              <div class="value" id="kpiRequired">—</div>
              <div class="note" id="kpiRequiredNote">Given return & step-up assumptions.</div>
            </div>
          </div>
        </div>

        <div class="heroArt" id="heroArt"></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="pad">
          <div class="miniTitle">Reality controls</div>

          <div class="controls">
            <div class="field">
              <label for="goalCorpus">Goal amount today (₹)</label>
              <input id="goalCorpus" type="number" min="0" step="50000" />
              <div class="hint">We inflate this to your target year.</div>
            </div>

            <div class="field">
              <label for="inflation">Inflation assumption</label>
              <select id="inflation">
                <option value="0.06">6% (typical)</option>
                <option value="0.08" selected>8% (education / lifestyle)</option>
                <option value="0.10">10% (aggressive)</option>
              </select>
              <div class="hint">Higher inflation = bigger future target.</div>
            </div>

            <div class="field">
              <label for="returnRate">Expected return</label>
              <select id="returnRate">
                <option value="0.09">9% (conservative)</option>
                <option value="0.11" selected>11% (balanced)</option>
                <option value="0.13">13% (aggressive)</option>
              </select>
              <div class="hint">Long-term diversified assumption.</div>
            </div>

            <div class="field">
              <label for="stepUp">Annual SIP step-up</label>
              <select id="stepUp">
                <option value="0" selected>0% (flat)</option>
                <option value="0.05">5% (gentle)</option>
                <option value="0.10">10% (strong)</option>
              </select>
              <div class="hint">Automation beats willpower.</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="miniTitle">Timeline tracker</div>
          <div class="progressWrap">
            <div class="progressBar">
              <div class="progGood" id="progGood" style="width:0%"></div>
              <div class="progBad" id="progBad" style="width:100%"></div>
            </div>
            <div class="progMeta">
              <div id="progLeft">Start: —</div>
              <div id="progMid">Today: —</div>
              <div id="progRight">Goal: —</div>
            </div>
            <div class="hint" id="timelineHint">Green = time already used. Red = time remaining.</div>
          </div>

          <div class="divider"></div>

          <div class="miniTitle">Projected growth line</div>
          <div class="chartBox">
            <canvas id="growthCanvas" width="900" height="260"></canvas>
            <div class="hint" id="chartHint">Line shows projected corpus path. Dots are checkpoints.</div>
          </div>

          <div class="divider"></div>

          <div class="miniTitle">Gap visualization</div>
          <div class="notice" id="gapBox">—</div>

          <div class="row">
            <button class="btn primary" id="lockBtn" type="button">Lock my plan (add friction)</button>
            <button class="btn" id="resetBtn" type="button">Reset demo data</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="pad">
          <div class="miniTitle">Loss aversion & social proof</div>
          <div class="notice" id="nudgeCard">—</div>

          <details open>
            <summary>Numbers breakdown</summary>
            <div style="margin-top:10px; color:var(--muted); font-size:14px;" id="breakdown">—</div>
          </details>

          <details>
            <summary>Benchmarks & comparisons</summary>
            <div style="margin-top:10px; color:var(--muted); font-size:14px;" id="benchmarks">—</div>
          </details>

          <div class="divider"></div>

          <div class="miniTitle">Quick simulations</div>
          <div class="row">
            <button class="btn" id="simulateDelayBtn" type="button">Simulate: delay 5 years</button>
            <button class="btn" id="simulateStepBtn" type="button">Simulate: add 10% step-up</button>
          </div>

          <div class="divider"></div>

          <div class="miniTitle">FAQ</div>
          <details>
            <summary>Why all this “friction”?</summary>
            <div style="margin-top:10px; color:var(--muted); font-size:14px;">
              Because impulse withdrawals destroy long-term goals. Friction forces a pause. A pause saves futures.
            </div>
          </details>
          <details>
            <summary>Can I change goal later?</summary>
            <div style="margin-top:10px; color:var(--muted); font-size:14px;">
              Yes — but we’ll show the cost of switching and the cost of delay.
            </div>
          </details>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>© <span id="year"></span> FutureLock</div>
      <div style="display:flex; gap:12px;">
        <a href="index.html">Home</a><span style="opacity:.5;">•</span>
        <a href="planner.html">Plan</a><span style="opacity:.5;">•</span>
        <a href="pricing.html">Pricing</a><span style="opacity:.5;">•</span>
        <a href="dashboard.html">Dashboard</a>
      </div>
    </div>
  </div>

  <div class="modalBack" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>Withdraw request</h3>
      <p id="modalText">—</p>

      <div class="field" style="margin-top:10px;">
        <label for="confirmWord">Type WITHDRAW to confirm</label>
        <input id="confirmWord" placeholder="WITHDRAW" />
        <div class="hint">This friction is intentional.</div>
      </div>

      <div class="modalActions" style="margin-top:12px;">
        <button class="btn" id="cancelModalBtn" type="button">Cancel</button>
        <button class="btn danger" id="confirmModalBtn" type="button">Confirm withdraw</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const now = new Date();
    $("year").textContent = now.getFullYear();

    const INR = (n) => "₹" + Math.round(Number(n||0)).toLocaleString("en-IN");
    const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));

    function getPlan(){
      try{ const raw = localStorage.getItem("futurelock_plan_v1"); return raw ? JSON.parse(raw) : null; }
      catch(e){ return null; }
    }
    function getPricing(){
      try{ const raw = localStorage.getItem("futurelock_pricing_v1"); return raw ? JSON.parse(raw) : null; }
      catch(e){ return null; }
    }

    function fvSip(monthly, years, annualReturn, stepUp){
      const r_m = annualReturn/12;
      const months = Math.max(0, Math.floor(years*12));
      let m = Number(monthly||0);
      let value = 0;
      for(let t=1;t<=months;t++){
        value = value*(1+r_m) + m;
        if(t%12===0) m = m*(1+stepUp);
      }
      return value;
    }

    function requiredMonthly(targetFV, years, annualReturn, stepUp){
      if(targetFV<=0 || years<=0) return 0;
      let lo=0, hi=Math.max(1000, targetFV/(years*12));
      while(fvSip(hi, years, annualReturn, stepUp) < targetFV){
        hi*=1.8;
        if(hi>5e7) break;
      }
      for(let i=0;i<40;i++){
        const mid=(lo+hi)/2;
        const fv=fvSip(mid, years, annualReturn, stepUp);
        if(fv>=targetFV) hi=mid; else lo=mid;
      }
      return hi;
    }

    function defaultGoalCorpusToday(goal, salaryMonthly){
      const s = Number(salaryMonthly||0);
      if(!s || s<=0){
        if(goal==="Retirement") return 30000000;
        if(goal==="Child Education") return 2500000;
        if(goal==="Buy a Home") return 5000000;
        if(goal==="Emergency Fund") return 300000;
        return 1000000;
      }
      const annual = s*12;
      if(goal==="Retirement"){ const exp=annual*0.70; return Math.round(25*exp); }
      if(goal==="Child Education"){ return Math.max(1500000, Math.round(annual*0.30)); }
      if(goal==="Buy a Home"){ return Math.max(3500000, Math.round(annual*2.5)); }
      if(goal==="Emergency Fund"){ return Math.round((s*0.70)*6); }
      return Math.max(500000, Math.round(annual*0.15));
    }

    function goalInflationDefault(goal){
      if(goal==="Child Education" || goal==="Health & Medical") return 0.08;
      return 0.06;
    }

    function goalArtSVG(goal){
      const common = 'width="100%" height="100%" viewBox="0 0 520 260" xmlns="http://www.w3.org/2000/svg"';
      if(goal==="Child Education"){
        return `<svg ${common}><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#1F7A4A"/><stop offset="1" stop-color="#2EA56A"/></linearGradient></defs>
        <rect x="14" y="18" width="492" height="224" rx="22" fill="rgba(255,255,255,0.75)" stroke="rgba(31,42,36,0.12)"/>
        <path d="M60 190 C 140 40, 230 240, 330 120 C 390 60, 440 70, 470 60" fill="none" stroke="rgba(31,42,36,0.16)" stroke-width="10" stroke-linecap="round"/>
        <path d="M60 190 C 140 40, 230 240, 330 120" fill="none" stroke="url(#g)" stroke-width="10" stroke-linecap="round"/>
        <circle cx="60" cy="190" r="10" fill="#1F7A4A"/><circle cx="330" cy="120" r="10" fill="#2EA56A"/><circle cx="470" cy="60" r="10" fill="rgba(31,42,36,0.20)"/>
        <circle cx="130" cy="170" r="16" fill="rgba(46,165,106,0.18)" /><circle cx="130" cy="160" r="10" fill="#f1d7c7"/>
        <rect x="120" y="170" width="20" height="26" rx="8" fill="#2EA56A"/>
        <polygon points="402,78 470,60 402,42 334,60" fill="#1F7A4A" opacity="0.85"/>
        <rect x="386" y="60" width="32" height="10" rx="4" fill="#2EA56A"/>
        <text x="36" y="54" font-size="14" fill="rgba(31,42,36,0.70)" font-weight="700">Kid → Graduation</text>
        <text x="36" y="76" font-size="12" fill="rgba(31,42,36,0.55)">Your SIP turns into choices later.</text></svg>`;
      }
      if(goal==="Retirement"){
        return `<svg ${common}><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#1F7A4A"/><stop offset="1" stop-color="#2EA56A"/></linearGradient></defs>
        <rect x="14" y="18" width="492" height="224" rx="22" fill="rgba(255,255,255,0.75)" stroke="rgba(31,42,36,0.12)"/>
        <path d="M60 190 C 150 70, 240 240, 350 125 C 410 60, 450 80, 470 70" fill="none" stroke="rgba(31,42,36,0.16)" stroke-width="10" stroke-linecap="round"/>
        <path d="M60 190 C 150 70, 240 240, 350 125" fill="none" stroke="url(#g)" stroke-width="10" stroke-linecap="round"/>
        <circle cx="60" cy="190" r="10" fill="#1F7A4A"/><circle cx="350" cy="125" r="10" fill="#2EA56A"/><circle cx="470" cy="70" r="10" fill="rgba(31,42,36,0.20)"/>
        <circle cx="120" cy="150" r="22" fill="rgba(46,165,106,0.14)" /><circle cx="120" cy="142" r="14" fill="#f1d7c7"/>
        <path d="M106 134 C112 122, 128 122, 134 134" stroke="#cfcfcf" stroke-width="6" stroke-linecap="round"/>
        <rect x="104" y="156" width="32" height="40" rx="14" fill="#2EA56A"/>
        <text x="36" y="54" font-size="14" fill="rgba(31,42,36,0.70)" font-weight="700">Future You (smiling)</text>
        <text x="36" y="76" font-size="12" fill="rgba(31,42,36,0.55)">Discipline buys peace.</text></svg>`;
      }
      return `<svg ${common}><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#1F7A4A"/><stop offset="1" stop-color="#2EA56A"/></linearGradient></defs>
      <rect x="14" y="18" width="492" height="224" rx="22" fill="rgba(255,255,255,0.75)" stroke="rgba(31,42,36,0.12)"/>
      <path d="M60 190 C 150 70, 240 240, 350 125 C 410 60, 450 80, 470 70" fill="none" stroke="rgba(31,42,36,0.16)" stroke-width="10" stroke-linecap="round"/>
      <path d="M60 190 C 150 70, 240 240, 350 125" fill="none" stroke="url(#g)" stroke-width="10" stroke-linecap="round"/>
      <circle cx="60" cy="190" r="10" fill="#1F7A4A"/><circle cx="350" cy="125" r="10" fill="#2EA56A"/><circle cx="470" cy="70" r="10" fill="rgba(31,42,36,0.20)"/>
      <text x="36" y="54" font-size="14" fill="rgba(31,42,36,0.70)" font-weight="700">Discipline → Outcome</text>
      <text x="36" y="76" font-size="12" fill="rgba(31,42,36,0.55)">Small steps, big endings.</text></svg>`;
    }

    function drawGrowth(canvas, points, targetLine){
      const ctx = canvas.getContext("2d");
      const W = canvas.width, H = canvas.height;
      ctx.clearRect(0,0,W,H);

      const pad = {l:40, r:14, t:18, b:28};
      const innerW = W - pad.l - pad.r;
      const innerH = H - pad.t - pad.b;

      const maxY = Math.max(targetLine||0, ...points.map(p=>p.y), 1);
      const minY = 0;

      ctx.globalAlpha = 0.7;
      ctx.strokeStyle = "rgba(31,42,36,0.20)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(pad.l, pad.t);
      ctx.lineTo(pad.l, pad.t + innerH);
      ctx.lineTo(pad.l + innerW, pad.t + innerH);
      ctx.stroke();
      ctx.globalAlpha = 1;

      if(targetLine && targetLine>0){
        const yT = pad.t + innerH - ((targetLine-minY)/(maxY-minY))*innerH;
        ctx.strokeStyle = "rgba(201,138,0,0.55)";
        ctx.setLineDash([6,6]);
        ctx.beginPath(); ctx.moveTo(pad.l, yT); ctx.lineTo(pad.l+innerW, yT); ctx.stroke();
        ctx.setLineDash([]);
        ctx.fillStyle = "rgba(107,76,0,0.80)";
        ctx.font = "12px Inter, Arial";
        ctx.fillText("Target", pad.l + 6, yT - 6);
      }

      ctx.strokeStyle = "rgba(31,122,74,0.85)";
      ctx.lineWidth = 3;
      ctx.beginPath();
      points.forEach((p,i)=>{
        const x = pad.l + (p.xNorm * innerW);
        const y = pad.t + innerH - ((p.y-minY)/(maxY-minY))*innerH;
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();

      ctx.fillStyle = "rgba(46,165,106,0.9)";
      points.forEach((p)=>{
        const x = pad.l + (p.xNorm * innerW);
        const y = pad.t + innerH - ((p.y-minY)/(maxY-minY))*innerH;
        ctx.beginPath(); ctx.arc(x,y,4,0,Math.PI*2); ctx.fill();
      });

      ctx.fillStyle = "rgba(31,42,36,0.60)";
      ctx.font = "12px Inter, Arial";
      ctx.fillText("Year 0", pad.l, pad.t + innerH + 18);
      ctx.fillText("Goal", pad.l + innerW - 26, pad.t + innerH + 18);
    }

    const plan = getPlan();
    const pricing = getPricing();

    if(!plan){
      $("headlineGoal").textContent = "No plan found";
      $("goalBadge").textContent = "Goal: —";
      $("confidenceBadge").textContent = "On-time chance: —";
      $("heroArt").innerHTML = goalArtSVG("Default");
      $("gapBox").classList.add("bad");
      $("gapBox").textContent = "Go to planner → fill → Save & Continue. Then return here.";
      $("nudgeCard").classList.add("bad");
      $("nudgeCard").textContent = "Behavioural nudge: remove ambiguity. Go build your plan first.";
      throw new Error("No plan data");
    }

    const goal = (plan.goal==="Other") ? (plan.otherGoal||"Other") : plan.goal;
    const salary = Number(plan.salaryMonthly||0);
    const sip = Number(plan.monthlyInvestment||0);
    const startYear = Number(plan.startYear||now.getFullYear());
    const targetYear = Number(plan.targetYear||(startYear+10));
    const yearsToGoal = Math.max(0, targetYear - startYear);

    $("goalBadge").textContent = "Goal: " + goal;
    $("headlineGoal").textContent = goal + " dashboard";
    $("heroArt").innerHTML = goalArtSVG(goal);

    if(pricing && pricing.plan){
      $("planBadge").style.display = "inline-flex";
      $("planBadge").textContent = "Plan: " + pricing.plan;
    }

    const inflDefault = goalInflationDefault(goal);
    $("inflation").value = String(inflDefault);

    const risk = (plan.risk || "Moderate");
    if(risk==="Conservative") $("returnRate").value = "0.09";
    if(risk==="Aggressive") $("returnRate").value = "0.13";

    $("goalCorpus").value = String(defaultGoalCorpusToday(goal, salary));

    function recompute(){
      const inflation = Number($("inflation").value);
      const annualReturn = Number($("returnRate").value);
      const stepUp = Number($("stepUp").value);
      const goalToday = Number($("goalCorpus").value||0);

      const goalFV = goalToday * Math.pow(1+inflation, yearsToGoal);
      const projectedFV = fvSip(sip, yearsToGoal, annualReturn, stepUp);
      const reqMonthly = requiredMonthly(goalFV, yearsToGoal, annualReturn, stepUp);

      const gap = goalFV - projectedFV;
      const chance = clamp(projectedFV / Math.max(1, goalFV), 0, 1);
      const chancePct = Math.round(chance*100);

      $("kpiTarget").textContent = INR(goalFV);
      $("kpiProjected").textContent = INR(projectedFV);
      $("kpiGapNote").textContent = "Gap: " + (gap>0 ? INR(gap) : "₹0 (ahead)");
      $("kpiRequired").textContent = INR(reqMonthly);

      $("confidenceBadge").textContent = "On-time chance: " + chancePct + "%";
      $("confidenceBadge").classList.remove("bad");
      if(chancePct < 70) $("confidenceBadge").classList.add("bad");

      const gapBox = $("gapBox");
      gapBox.classList.remove("bad");
      if(gap>0){
        gapBox.classList.add("bad");
        const shortPerMonth = Math.max(0, reqMonthly - sip);
        gapBox.textContent = `You’re short by ~${INR(gap)} at goal date. Increase SIP by ~${INR(shortPerMonth)} or add step-up.`;
      }else{
        gapBox.textContent = "You’re on track (or ahead). Your job now: don’t sabotage consistency.";
      }

      const todayYear = now.getFullYear();
      const clampedToday = clamp(todayYear, startYear, targetYear);
      const used = (clampedToday - startYear);
      const usedPct = yearsToGoal>0 ? (used/yearsToGoal)*100 : 100;
      const goodW = clamp(usedPct, 0, 100);
      $("progGood").style.width = goodW + "%";
      $("progBad").style.width = (100-goodW) + "%";
      $("progLeft").textContent = "Start: " + startYear;
      $("progMid").textContent = "Today: " + clampedToday;
      $("progRight").textContent = "Goal: " + targetYear;
      $("timelineHint").textContent = `You have ${Math.max(0, targetYear-clampedToday)} years left. Delay makes the monthly burden heavier.`;

      const pts = [];
      const steps = Math.max(2, Math.min(12, yearsToGoal+1));
      for(let i=0;i<steps;i++){
        const y = yearsToGoal * (i/(steps-1));
        pts.push({xNorm: i/(steps-1), y: fvSip(sip, y, annualReturn, stepUp)});
      }
      drawGrowth($("growthCanvas"), pts, goalFV);

      $("breakdown").innerHTML =
        `Start: <b>${startYear}</b> • Target: <b>${targetYear}</b> • Horizon: <b>${yearsToGoal} years</b><br/>
         Your SIP: <b>${INR(sip)}</b>/mo • Return: <b>${Math.round(annualReturn*100)}%</b> • Step-up: <b>${Math.round(stepUp*100)}%</b><br/>
         Goal today: <b>${INR(goalToday)}</b> • Inflation: <b>${Math.round(inflation*100)}%</b> → Target: <b>${INR(goalFV)}</b><br/>
         Required SIP: <b>${INR(reqMonthly)}</b> • Projected: <b>${INR(projectedFV)}</b>`;

      const socialPct = 58 + Math.floor(Math.random()*28);
      $("benchmarks").innerHTML =
        `Social proof (demo): <b>${socialPct}%</b> of users who picked “${goal}” enabled step-ups or nudges.<br/>
         Your SIP rate: <b>${salary>0 ? Math.round((sip/salary)*100) : 0}%</b> of salary.`;

      const reqLate = requiredMonthly(goalFV, Math.max(1, yearsToGoal-5), annualReturn, stepUp);
      const extra = Math.max(0, reqLate - reqMonthly);

      const nudgeOptions = [
        `Delay costs. If you wait 5 years, required SIP may rise by ~${INR(extra)}/month.`,
        `Your SIP is ${INR(sip)}. On-track SIP is ${INR(reqMonthly)}. Small gap today becomes big stress later.`,
        `${socialPct}% of people who set this goal used automation. Make the good move the default.`
      ];
      $("nudgeCard").textContent = nudgeOptions[Math.floor(Math.random()*nudgeOptions.length)];
      $("nudgeCard").classList.toggle("bad", gap>0);
    }

    ["goalCorpus","inflation","returnRate","stepUp"].forEach(id=>{
      $(id).addEventListener("input", recompute);
      $(id).addEventListener("change", recompute);
    });

    $("simulateDelayBtn").addEventListener("click", ()=>{
      const inflation = Number($("inflation").value);
      const annualReturn = Number($("returnRate").value);
      const stepUp = Number($("stepUp").value);
      const goalToday = Number($("goalCorpus").value||0);
      const goalFV = goalToday * Math.pow(1+inflation, yearsToGoal);

      const reqNow = requiredMonthly(goalFV, yearsToGoal, annualReturn, stepUp);
      const reqLate = requiredMonthly(goalFV, Math.max(1, yearsToGoal-5), annualReturn, stepUp);
      const extra = Math.max(0, reqLate - reqNow);

      $("nudgeCard").textContent = `If you delay 5 years, required SIP can jump by ~${INR(extra)}/month.`;
      $("nudgeCard").classList.add("bad");
    });

    $("simulateStepBtn").addEventListener("click", ()=>{
      $("stepUp").value = "0.10";
      recompute();
      $("nudgeCard").textContent = "10% yearly step-up = discipline without pain today.";
    });

    $("lockBtn").addEventListener("click", ()=>{
      localStorage.setItem("futurelock_lock_mode", "true");
      $("nudgeCard").textContent = "Locked ✅ Withdrawals now require extra confirmation. Friction is a feature.";
    });

    $("resetBtn").addEventListener("click", ()=>{
      if(confirm("Clear all saved demo data (plan + pricing + lock)?")){
        localStorage.removeItem("futurelock_plan_v1");
        localStorage.removeItem("futurelock_pricing_v1");
        localStorage.removeItem("futurelock_lock_mode");
        window.location.href="planner.html";
      }
    });

    const modalBack = $("modalBack");
    const openModal = (text)=>{ $("modalText").textContent=text; modalBack.style.display="flex"; $("confirmWord").value=""; };
    const closeModal = ()=>{ modalBack.style.display="none"; };

    $("cancelModalBtn").addEventListener("click", closeModal);
    modalBack.addEventListener("click",(e)=>{ if(e.target===modalBack) closeModal(); });

    $("redeemBtn").addEventListener("click", ()=>{
      const lock = localStorage.getItem("futurelock_lock_mode")==="true";
      const msg = lock
        ? `Withdrawing now may reduce your future options for “${goal}”. This pause is intentional.`
        : `Withdrawing now may reduce your future options for “${goal}”. Are you sure?`;
      openModal(msg);
    });

    $("confirmModalBtn").addEventListener("click", ()=>{
      const word = ($("confirmWord").value||"").trim().toUpperCase();
      if(word!=="WITHDRAW"){ alert("Type WITHDRAW to confirm."); return; }
      closeModal();
      alert("Withdrawal requested (demo). In real life, redemption workflow would start.");
    });

    recompute();
  </script>
</body>
</html>
